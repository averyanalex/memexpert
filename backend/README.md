# MemeXpert Backend

A FastAPI-based backend service for MemeXpert - an intelligent meme management system that automatically generates tags for memes using AI and provides powerful search capabilities.

## ğŸš€ Features

- **Automatic Tag Generation**: AI-powered tag generation for uploaded memes
- **Smart Search**: Search memes by tags with substring matching
- **RESTful API**: REST endpoints for meme management
- **Async Architecture**: Full async/await support for high performance
- **Database Management**: PostgreSQL with SQLModel/SQLAlchemy ORM
- **Dependency Injection**: Clean architecture with Dishka DI container
- **Observability**: Built-in telemetry and monitoring
- **Type Safety**: Full type hints with Pydantic validation

## ğŸ—ï¸ Architecture

```text
src/backend/
â”œâ”€â”€ __init__.py           # FastAPI app setup and DI container
â”œâ”€â”€ config.py             # Configuration management
â”œâ”€â”€ db.py                 # Database connection setup
â”œâ”€â”€ router.py             # API endpoints
â”œâ”€â”€ clients/              # External service clients
â”‚   â”œâ”€â”€ __init__.py       # Client exports
â”‚   â””â”€â”€ agent.py          # AI agent client implementation
â”œâ”€â”€ models/               # SQLModel database models
â”‚   â”œâ”€â”€ meme.py           # Meme model
â”‚   â”œâ”€â”€ tag.py            # Tag model
â”‚   â””â”€â”€ meme_tag_link.py  # Many-to-many relationship
â”œâ”€â”€ schemas/              # Pydantic API schemas
â”‚   â””â”€â”€ meme.py           # Request/response models
â”œâ”€â”€ repositories/         # Data access layer
â”‚   â”œâ”€â”€ memes.py          # Meme repository
â”‚   â””â”€â”€ tags.py           # Tag repository
â””â”€â”€ services/             # Business logic layer
    â””â”€â”€ meme.py           # Meme service
```

## ğŸ› ï¸ Tech Stack

- **Framework**: FastAPI
- **Database**: PostgreSQL with asyncpg driver
- **ORM**: SQLModel (SQLAlchemy + Pydantic)
- **Dependency Injection**: Dishka
- **Migrations**: Alembic
- **Package Management**: uv
- **Python Version**: 3.13+

## ğŸ“‹ Prerequisites

- Python 3.13+
- PostgreSQL 17+
- Docker & Docker Compose (for development)
- uv package manager

## ğŸš€ Quick Start

### 1. Clone and Setup

```bash
# Install dependencies
uv sync

# Copy environment configuration
cp .env.example .env
```

### 2. Start Database

```bash
# Start PostgreSQL with Docker Compose
docker-compose up -d db
```

### 3. Run Migrations

```bash
# Apply database migrations
uv run alembic upgrade head
```

### 4. Start the Server

```bash
# Development server
uv run uvicorn --port 8010 backend:app
```

The API will be available at `http://localhost:8010`

## ğŸ“š API Documentation

### Endpoints

#### Create Meme

```http
POST /memes
Content-Type: application/json

{
  "file_id": "string",
  "file_unique_id": "string", 
  "file_data": "base64_encoded_image"
}
```

#### Search Memes

```http
GET /memes?text=funny&limit=10
```

### Interactive Documentation

- **Swagger UI**: `http://localhost:8010/docs`
- **ReDoc**: `http://localhost:8010/redoc`
- **OpenAPI Spec**: `http://localhost:8010/openapi.json`

## ğŸ—„ï¸ Database Schema

### Tables

- **memes**: Stores meme metadata (file_id, file_unique_id)
- **tags**: Stores unique tag names
- **meme_tag_links**: Many-to-many relationship between memes and tags

### Key Relationships

- One meme can have multiple tags
- One tag can be associated with multiple memes
- Tags are automatically generated by AI agent

## ğŸ§ª Development

### Code Quality

```bash
# Type checking
uv run mypy src/

# Linting and formatting
uv run ruff check src/
uv run ruff format src/
```

### Database Migrations

```bash
# Create new migration
uv run alembic revision --autogenerate -m "Description"

# Apply migrations
uv run alembic upgrade head

# Rollback migration
uv run alembic downgrade -1
```

## ğŸ­ Services & Clients

### MemeService

- Handles meme creation and search operations
- Uses AgentClient directly for AI tag generation
- Manages database transactions and meme-tag relationships

### AgentClient

- Direct client for AI agent HTTP API
- Handles tag generation for uploaded memes
- Manages HTTP connections and request/response handling
- Async context manager for efficient resource management
- Custom exception handling for network and API errors

## ğŸ” Key Features Deep Dive

### Automatic Tag Generation

When a meme is uploaded, the system:

1. MemeService receives the meme creation request
2. Uses AgentClient to call external AI agent directly
3. AgentClient sends image data and receives generated tags
4. Stores tags in normalized database structure
5. Links tags to the meme via junction table

### Smart Search

The search functionality supports:

- Full-text search across tag names
- Case-insensitive matching with ILIKE
- Configurable result limits
